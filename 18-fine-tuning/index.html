<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Index - GenAI新手入门</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Index";
        var mkdocs_page_input_path = "18-fine-tuning\\README.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> GenAI新手入门
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../00-course-setup/translations/cn/">课程介绍和学习环境设置</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../01-introduction-to-genai/translations/cn/">第一章：生成式人工智能和 LLMs 介绍</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../02-exploring-and-comparing-different-llms/translations/cn/">第二章：探索和比较不同的 LLMs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../03-using-generative-ai-responsibly/translations/cn/">第三章：负责任地使用生成式人工智能</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../04-prompt-engineering-fundamentals/translations/cn/">第四章：提示工程基础</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../05-advanced-prompts/translations/cn/">第五章：创建高级的提示工程技巧</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../06-text-generation-apps/translations/cn/">第六章：创建文本生成应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../07-building-chat-applications/translations/cn/">第七章：创建聊天应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../08-building-search-applications/translations/cn/">第八章：创建搜索应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../09-building-image-applications/translations/cn/">第九章：创建图像应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../10-building-low-code-ai-applications/translations/cn/">第十章：创建低代码AI应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../11-integrating-with-function-calling/translations/cn/">第十一章：集成函数调用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../12-designing-ux-for-ai-applications/translations/cn/">第十二章：为人工智能应用程序设计用户体验</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../13-securing-ai-applications/translations/cn/">第十三章：保护AI应用程序</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../14-the-generative-ai-application-lifecycle/translations/cn/">第十四章：生成式AI应用生命周期</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../15-rag-and-vector-databases/translations/cn/">第十五章：检索增强生成和向量数据库</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../16-open-source-models/translations/tw/">第十六章：开源模型</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../17-ai-agents/translations/tw/">第十七章：AI Agent</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="translations/tw/">第十八章：微调</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../19-slm/">第十九章：SLM模型</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../20-mistral/">第二十章：Mistral的模型</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../21-meta/">第二十一章：Meta的模型</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">GenAI新手入门</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Index</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p><a href="https://aka.ms/gen-ai-lesson18-gh?WT.mc_id=academic-105485-koreyst"><img alt="Open Source Models" src="img/18-lesson-banner.png?WT.mc_id=academic-105485-koreyst" /></a></p>
<h1 id="fine-tuning-your-llm">Fine-Tuning Your LLM</h1>
<p>Using large language models to build generative AI applications comes with new challenges. A key issue is ensuring response quality (accuracy and relevance) in content generated by the model for a given user request. In previous lessons, we discussed techniques like prompt engineering and retrieval-augmented generation that try to solve the problem by <em>modifying the prompt input</em> to the existing model.</p>
<p>In today's lesson, we discuss a third technique, <strong>fine-tuning</strong>, which tries to address the challenge by <em>retraining the model itself</em> with additional data. Let's dive into the details.</p>
<h2 id="learning-objectives">Learning Objectives</h2>
<p>This lesson introduces the concept of fine-tuning for pre-trained language models, explores the benefits and challenges of this approach, and provides guidance on when and how to use fine tuning to improve the performance of your generative AI models.</p>
<p>By the end of this lesson, you should be able to answer the following questions:</p>
<ul>
<li>What is fine tuning for language models?</li>
<li>When, and why, is fine tuning useful?</li>
<li>How can I fine-tune a pre-trained model?</li>
<li>What are the limitations of fine-tuning?</li>
</ul>
<p>Ready? Let's get started.</p>
<h2 id="illustrated-guide">Illustrated Guide</h2>
<p>Want to get the big picture of what we'll cover before we dive in? Check out this illustrated guide that describes the learning journey for this lesson - from learning the core concepts and motivation for fine-tuning, to understanding the process and best practices for executing the fine-tuning task. This is a fascinating topic for exploration, so don't forget to check out the <a href="RESOURCES/?WT.mc_id=academic-105485-koreyst">Resources</a> page for additional links to support your self-guided learning journey!</p>
<p><img alt="Illustrated Guide to Fine Tuning Language Models" src="img/18-fine-tuning-sketchnote.png?WT.mc_id=academic-105485-koreyst" /></p>
<h2 id="what-is-fine-tuning-for-language-models">What is fine-tuning for language models?</h2>
<p>By definition, large language models are <em>pre-trained</em> on large quantities of text sourced from diverse sources including the internet. As we've learned in previous lessons, we need techniques like <em>prompt engineering</em> and <em>retrieval-augmented generation</em> to improve the quality of the model's responses to the user's questions ("prompts").</p>
<p>A popular prompt-engineering technique involves giving the model more guidance on what is expected in the response either by providing <em>instructions</em> (explicit guidance) or <em>giving it a few examples</em> (implicit guidance). This is referred to as <em>few-shot learning</em> but it has two limitations:</p>
<ul>
<li>Model token limits can restrict the number of examples you can give, and limit the effectiveness.</li>
<li>Model token costs can make it expensive to add examples to every prompt, and limit flexibility.</li>
</ul>
<p>Fine-tuning is a common practice in machine learning systems where we take a pre-trained model and retrain it with new data to improve its performance on a specific task. In the context of language models, we can fine-tune the pre-trained model <em>with a curated set of examples for a given task or application domain</em> to create a <strong>custom model</strong> that may be more accurate and relevant for that specific task or domain. A side-benefit of fine-tuning is that it can also reduce the number of examples needed for few-shot learning - reducing token usage and related costs.</p>
<h2 id="when-and-why-should-we-fine-tune-models">When and why should we fine-tune models?</h2>
<p>In <em>this</em> context, when we talk about fine-tuning, we are referring to <strong>supervised</strong> fine-tuning where the retraining is done by <strong>adding new data</strong> that was not part of the original training dataset. This is different from an unsupervised fine-tuning approach where the model is retrained on the original data, but with different hyperparameters.</p>
<p>The key thing to remember is that fine-tuning is an advanced technique that requires a certain level of expertise to get the desired results. If done incorrectly, it may not provide the expected improvements, and may even degrade the performance of the model for your targeted domain.</p>
<p>So, before you learn "how" to fine-tune language models, you need to know "why" you should take this route, and "when" to start the process of fine-tuning. Start by asking yourself these questions:</p>
<ul>
<li><strong>Use Case</strong>: What is your <em>use case</em> for fine-tuning? What aspect of the current pre-trained model do you want to improve upon?</li>
<li><strong>Alternatives</strong>: Have you tried <em>other techniques</em> to achieve the desired outcomes? Use them to create a baseline for comparison.</li>
<li>Prompt engineering: Try techniques like few-shot prompting with examples of relevant prompt responses. Evaluate the quality of responses.</li>
<li>Retrieval Augmented Generation: Try augmenting prompts with query results retrieved by searching your data. Evaluate the quality of responses.</li>
<li><strong>Costs</strong>: Have you identified the costs for fine-tuning?</li>
<li>Tunability - is the pre-trained model available for fine-tuning?</li>
<li>Effort - for preparing training data, evaluating &amp; refining model.</li>
<li>Compute - for running fine-tuning jobs, and deploying fine-tuned model</li>
<li>Data - access to sufficient quality examples for fine-tuning impact</li>
<li><strong>Benefits</strong>: Have you confirmed the benefits for fine-tuning?</li>
<li>Quality - did fine-tuned model outperform baseline?</li>
<li>Cost - does it reduce token usage by simplifying prompts?</li>
<li>Extensibility - can you repurpose base model for new domains?</li>
</ul>
<p>By answering these questions, you should be able to decide if fine-tuning is the right approach for your use case. Ideally, the approach is valid only if the benefits outweigh the costs. Once you decide to proceed, it's time to think about <em>how</em> you can fine tune the pre-trained model.</p>
<p>Want to get more insights on the decision-making process? Watch <a href="https://www.youtube.com/watch?v=0Jo-z-MFxJs">To fine-tune or not to fine-tune</a></p>
<h2 id="how-can-we-fine-tune-a-pre-trained-model">How can we fine-tune a pre-trained model?</h2>
<p>To fine-tune a pre-trained model, you need to have:</p>
<ul>
<li>a pre-trained model to fine-tune</li>
<li>a dataset to use for fine-tuning</li>
<li>a training environment to run the fine-tuning job</li>
<li>a hosting environment to deploy fine-tuned model</li>
</ul>
<h2 id="fine-tuning-in-action">Fine-Tuning In Action</h2>
<p>The following resources provide step-by-step tutorials to walk you through a real example using a selected model with a curated dataset. To work through these tutorials, you need an account on the specific provider, along with access to the relevant model and datasets.</p>
<table>
<thead>
<tr>
<th>Provider</th>
<th>Tutorial</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>OpenAI</td>
<td><a href="https://github.com/openai/openai-cookbook/blob/main/examples/How_to_finetune_chat_models.ipynb?WT.mc_id=academic-105485-koreyst">How to fine-tune chat models</a></td>
<td>Learn to fine-tune a <code>gpt-35-turbo</code> for a specific domain ("recipe assistant") by preparing training data, running the fine-tuning job, and using the fine-tuned model for inference.</td>
</tr>
<tr>
<td>Azure OpenAI</td>
<td><a href="https://learn.microsoft.com/azure/ai-services/openai/tutorials/fine-tune?tabs=python-new%2Ccommand-line?WT.mc_id=academic-105485-koreyst">GPT 3.5 Turbo fine-tuning tutorial</a></td>
<td>Learn to fine-tune a <code>gpt-35-turbo-0613</code> model <strong>on Azure</strong> by taking steps to create &amp; upload training data, run the fine-tuning job. Deploy &amp; use the new model.</td>
</tr>
<tr>
<td>Hugging Face</td>
<td><a href="https://www.philschmid.de/fine-tune-llms-in-2024-with-trl?WT.mc_id=academic-105485-koreyst">Fine-tuning LLMs with Hugging Face</a></td>
<td>This blog post walks you fine-tuning an <em>open LLM</em> (ex: <code>CodeLlama 7B</code>) using the <a href="https://huggingface.co/docs/transformers/index?WT.mc_id=academic-105485-koreyst">transformers</a> library &amp; <a href="https://huggingface.co/docs/trl/index?WT.mc_id=academic-105485-koreyst]">Transformer Reinforcement Learning (TRL)</a> with open <a href="https://huggingface.co/docs/datasets/index?WT.mc_id=academic-105485-koreyst">datasets</a> on Hugging Face.</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>🤗 AutoTrain</td>
<td><a href="https://github.com/huggingface/autotrain-advanced/?WT.mc_id=academic-105485-koreyst">Fine-tuning LLMs with AutoTrain</a></td>
<td>AutoTrain (or AutoTrain Advanced) is a python library developed by Hugging Face that allows finetuning for many different tasks including LLM finetuning. AutoTrain is a no-code solution and finetuning can be done in your own cloud, on Hugging Face Spaces or locally. It supports both a web-based GUI, CLI and training via yaml config files.</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="assignment">Assignment</h2>
<p>Select one of the tutorials above and walk through them. <em>We may replicate a version of these tutorials in Jupyter Notebooks in this repo for reference only. Please use the original sources directly to get the latest versions</em>.</p>
<h2 id="great-work-continue-your-learning">Great Work! Continue Your Learning.</h2>
<p>After completing this lesson, check out our <a href="https://aka.ms/genai-collection?WT.mc_id=academic-105485-koreyst">Generative AI Learning collection</a> to continue leveling up your Generative AI knowledge!</p>
<p>Congratulations!! You have completed the final lesson from the v2 series for this course! Don't stop learning and building. **Check out the <a href="RESOURCES/?WT.mc_id=academic-105485-koreyst">RESOURCES</a> page for a list of additional suggestions for just this topic.</p>
<p>Our v1 series of lessons have also been updated with more assignments and concepts. So take a minute to refresh your knowledge - and please <a href="https://github.com/microsoft/generative-ai-for-beginners/issues?WT.mc_id=academic-105485-koreyst">share your questions and feedback</a> to help us improve these lessons for the community.</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
