<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../img/favicon.ico" />
    <title>建構文本生成應用程式 - genaibeginner</title>
    <link rel="stylesheet" href="../../../css/theme.css" />
    <link rel="stylesheet" href="../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u5efa\u69cb\u6587\u672c\u751f\u6210\u61c9\u7528\u7a0b\u5f0f";
        var mkdocs_page_input_path = "06-text-generation-apps\\translations\\tw\\README.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../.." class="icon icon-home"> genaibeginner
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../00-course-setup/translations/cn/">课程介绍和学习环境设置</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../01-introduction-to-genai/translations/cn/">第一章：生成式人工智能和 LLMs 介绍</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../02-exploring-and-comparing-different-llms/translations/cn/">第二章：探索和比较不同的 LLMs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../03-using-generative-ai-responsibly/translations/cn/">第三章：负责任地使用生成式人工智能</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../04-prompt-engineering-fundamentals/translations/cn/">第四章：提示工程基础</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../05-advanced-prompts/translations/cn/">第五章：创建高级的提示工程技巧</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../cn/">第六章：创建文本生成应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../07-building-chat-applications/translations/cn/">第七章：创建聊天应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../08-building-search-applications/translations/cn/">第八章：创建搜索应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../09-building-image-applications/translations/cn/">第九章：创建图像应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../10-building-low-code-ai-applications/translations/cn/">第十章：创建低代码AI应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../11-integrating-with-function-calling/translations/cn/">第十一章：集成函数调用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../12-designing-ux-for-ai-applications/translations/cn/">第十二章：为人工智能应用程序设计用户体验</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../13-securing-ai-applications/translations/cn/">第十三章：保护AI应用程序</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../14-the-generative-ai-application-lifecycle/translations/cn/">第十四章：生成式AI应用生命周期</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../15-rag-and-vector-databases/translations/cn/">第十五章：检索增强生成和向量数据库</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../16-open-source-models/translations/tw/">第十六章：开源模型</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../17-ai-agents/translations/tw/">第十七章：AI Agent</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../18-fine-tuning/translations/tw/">第十八章：微调</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../19-slm/">第十九章：SLM模型</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../20-mistral/">第二十章：Mistral的模型</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../21-meta/">第二十一章：Meta的模型</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../..">genaibeginner</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../.." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">建構文本生成應用程式</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="_1">建構文本生成應用程式</h1>
<p><a href="https://aka.ms/gen-ai-lesson6-gh?WT.mc_id=academic-105485-koreyst"><img alt="建構文本生成應用程式" src="../../images/06-lesson-banner.png?WT.mc_id=academic-105485-koreyst" /></a></p>
<blockquote>
<p><em>(點擊上方圖片以觀看本課的影片)</em></p>
</blockquote>
<p>你已經透過這個課程看到了核心概念，如提示，甚至還有一個叫做「提示工程」的整個學科。許多工具如ChatGPT、Office 365、Microsoft Power Platform等，都支持你使用提示來完成某些事情。</p>
<p>為了讓你將這樣的體驗添加到應用程式中，你需要了解提示、完成等概念，並選擇一個函式庫來使用。這正是你在本章中將學到的內容。</p>
<h2 id="_2">簡介</h2>
<p>在本章中，你將：</p>
<ul>
<li>了解 openai 函式庫及其核心概念。</li>
<li>使用 openai 建構一個文字產生應用程式。</li>
<li>了解如何使用提示、溫度和代幣等概念來建構一個文字產生應用程式。</li>
</ul>
<h2 id="_3">學習目標</h2>
<p>在本課程結束時，你將能夠：</p>
<ul>
<li>解釋什麼是文字生成應用程式。</li>
<li>使用 openai 建立一個文字生成應用程式。</li>
<li>配置你的應用程式以使用更多或更少的 tokens，並且改變溫度，以獲得多樣化的輸出。</li>
</ul>
<h2 id="_4">什麼是文字生成應用程式?</h2>
<p>通常當你建構一個應用程式時，它會有某種介面，如下所示:</p>
<ul>
<li>基於命令。控制台應用程式是典型的應用程式，你輸入一個命令，它就會執行一個任務。例如，<code>git</code> 是一個基於命令的應用程式。</li>
<li>使用者介面 (UI)。有些應用程式有圖形使用者介面 (GUI)，你可以點擊按鈕、輸入文字、選擇選項等。</li>
</ul>
<h3 id="ui">控制台和 UI 應用程式是有限的</h3>
<p>將其與基於命令的應用程式進行比較，在那裡你輸入一個命令:</p>
<ul>
<li><strong>它有限制</strong>。你不能隨便輸入任何命令，只能輸入應用程式支援的命令。</li>
<li><strong>特定語言</strong>。有些應用程式支援多種語言，但預設情況下應用程式是為特定語言建構的，即使你可以添加更多語言支援。</li>
</ul>
<h3 id="_5">文字生成應用程式的好處</h3>
<p>那麼文本生成應用程式有什麼不同呢?</p>
<p>在一個文本生成應用中，你有更多的靈活性，你不會被限制於一組命令或特定的輸入語言。相反，你可以使用自然語言與應用互動。另一個好處是，因為你已經在與一個經過大量資訊訓練的數據源互動，而傳統應用可能會被限制於資料庫中的內容。</p>
<h3 id="_6">我可以用文字生成應用程式建構什麼？</h3>
<p>有許多事情你可以建構。例如:</p>
<ul>
<li><strong>聊天機器人</strong>。一個回答有關主題問題的聊天機器人，比如你的公司及其產品，可能是一個很好的匹配。</li>
<li><strong>助手</strong>。LLM 在總結文本、從文本中獲取見解、生成像簡歷這樣的文本等方面非常出色。</li>
<li><strong>程式碼助手</strong>。根據你使用的語言模型，你可以建構一個幫助你編寫程式碼的程式碼助手。例如，你可以使用像 GitHub Copilot 以及 ChatGPT 這樣的產品來幫助你編寫程式碼。</li>
</ul>
<h2 id="_7">我該如何開始？</h2>
<p>嗯，你需要找到一種方式來整合 LLM，這通常涉及以下兩種方法：</p>
<ul>
<li>使用 API。在這裡，你正在使用提示來構建網路請求並獲取生成的文本。</li>
<li>使用函式庫。函式庫有助於封裝 API 呼叫並使其更易於使用。</li>
</ul>
<h2 id="sdks">函式庫/SDKs</h2>
<p>有一些知名的函式庫可用於處理 LLM，例如:</p>
<ul>
<li><strong>openai</strong>，此函式庫讓連接到您的模型並發送提示變得容易。</li>
</ul>
<p>然後有一些函式庫在更高層次上運作，例如:</p>
<ul>
<li><strong>Langchain</strong>。Langchain 眾所周知並且支援 Python。</li>
<li><strong>Semantic Kernel</strong>。Semantic Kernel 是 Microsoft 的一個函式庫，支援 C#、Python 和 Java 語言。</li>
</ul>
<h2 id="openai">第一個使用 openai 的應用程式</h2>
<p>讓我們看看如何建構我們的第一個應用程式，需要哪些函式庫，需要多少等等。</p>
<h3 id="openai_1">安裝 openai</h3>
<p>有許多函式庫可以與 OpenAI 或 Azure OpenAI 互動。也可以使用多種程式語言，如 C#、Python、JavaScript、Java 等。我們選擇使用 <code>openai</code> Python 函式庫，因此我們將使用 <code>pip</code> 來安裝它。</p>
<pre><code class="language-bash">pip install openai
</code></pre>
<h3 id="_8">建立資源</h3>
<p>你需要執行以下步驟:</p>
<ul>
<li>在 Azure 上建立帳戶 <a href="https://azure.microsoft.com/free/?WT.mc_id=academic-105485-koreyst">https://azure.microsoft.com/free/</a>。</li>
<li>獲取 Azure OpenAI 的存取權。前往 <a href="https://learn.microsoft.com/azure/ai-services/openai/overview#how-do-i-get-access-to-azure-openai?WT.mc_id=academic-105485-koreyst">https://learn.microsoft.com/azure/ai-services/openai/overview#how-do-i-get-access-to-azure-openai</a> 並請求存取權。</li>
</ul>
<blockquote>
<p>[!NOTE]
在撰寫本文時，您需要申請存取 Azure OpenAI。</p>
</blockquote>
<ul>
<li>安裝 Python <a href="https://www.python.org/">https://www.python.org/</a></li>
<li>已建立 Azure OpenAI 服務資源。請參閱此指南了解如何<a href="https://learn.microsoft.com/azure/ai-services/openai/how-to/create-resource?pivots=web-portal?WT.mc_id=academic-105485-koreyst">建立資源</a>。</li>
</ul>
<h3 id="api">找到 API 金鑰和端點</h3>
<p>此時，你需要告訴你的 <code>openai</code> 函式庫要使用哪個 API 金鑰。要找到你的 API 金鑰，請前往 Azure OpenAI 資源的 "Keys and Endpoint" 部分並複製 "Key 1" 值。</p>
<p><img alt="金鑰和端點資源頁面在 Azure Portal 中" src="https://learn.microsoft.com/azure/ai-services/openai/media/quickstarts/endpoint.png?WT.mc_id=academic-105485-koreyst" /></p>
<p>現在你已經複製了這些資訊，讓我們指示函式庫使用它。</p>
<blockquote>
<p>[!NOTE]
值得將您的 API 金鑰與程式碼分開。您可以使用環境變數來做到這一點。</p>
<ul>
<li>將環境變數 <code>OPENAI_API_KEY</code> 設定為您的 API 金鑰。
  <code>export OPENAI_API_KEY='sk-...'</code></li>
</ul>
</blockquote>
<h3 id="azure">設定配置 Azure</h3>
<p>如果你正在使用 Azure OpenAI，以下是設定配置的方法:</p>
<pre><code class="language-python">openai.api_type = 'azure'
openai.api_key = os.environ[&quot;OPENAI_API_KEY&quot;]
openai.api_version = '2023-05-15'
openai.api_base = os.getenv(&quot;API_BASE&quot;)
</code></pre>
<p>以上我們設定以下內容:</p>
<ul>
<li><code>api_type</code> 設為 <code>azure</code>。這告訴函式庫使用 Azure OpenAI 而非 OpenAI。</li>
<li><code>api_key</code>，這是你在 Azure Portal 中找到的 API 金鑰。</li>
<li><code>api_version</code>，這是你想使用的 API 版本。在撰寫本文時，最新的版本是 <code>2023-05-15</code>。</li>
<li><code>api_base</code>，這是 API 的端點。你可以在 Azure Portal 中的 API 金鑰旁找到。</li>
</ul>
<blockquote>
<p>[!NOTE] &gt; <code>os.getenv</code> 是一個讀取環境變數的函式。你可以使用它來讀取像是 <code>OPENAI_API_KEY</code> 和 <code>API_BASE</code> 的環境變數。在你的終端機中設定這些環境變數或使用像 <code>dotenv</code> 這樣的函式庫。</p>
</blockquote>
<h2 id="_9">產生文字</h2>
<p>生成文本的方法是使用 <code>Completion</code> 類別。以下是一個範例:</p>
<pre><code class="language-python">prompt = &quot;Complete the following: Once upon a time there was a&quot;

completion = openai.Completion.create(model=&quot;davinci-002&quot;, prompt=prompt)
print(completion.choices[0].text)
</code></pre>
<p>在上述程式碼中，我們建立一個完成物件並傳入我們想要使用的模型和提示。然後我們列印產生的文字。</p>
<h3 id="_10">聊天完成</h3>
<p>到目前為止，你已經看到我們如何使用 <code>Completion</code> 來產生文本。但還有另一個更適合聊天機器人的類別，稱為 <code>ChatCompletion</code>。以下是使用它的範例：</p>
<pre><code class="language-python">import openai

openai.api_key = &quot;sk-...&quot;

completion = openai.ChatCompletion.create(model=&quot;gpt-3.5-turbo&quot;, messages=[{&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: &quot;Hello world&quot;}])
print(completion.choices[0].message.content)
</code></pre>
<p>更多關於此功能的資訊在即將到來的章節中。</p>
<h2 id="-">練習 - 您的第一個文本生成應用程序</h2>
<p>現在我們已經學會如何設定和配置 openai，是時候建構你的第一個文字產生應用了。要建構你的應用，請按照以下步驟操作:</p>
<ol>
<li>建立虛擬環境並安裝 openai:</li>
</ol>
<p><code>bash
   python -m venv venv
   source venv/bin/activate
   pip install openai</code></p>
<blockquote>
<p>[!NOTE]
如果你使用的是 Windows，請輸入 <code>venv\Scripts\activate</code> 而不是 <code>source venv/bin/activate</code>。</p>
<p>[!NOTE]
前往 <a href="https://portal.azure.com/?WT.mc_id=academic-105485-koreyst">https://portal.azure.com/</a> 並搜尋 <code>Open AI</code>，選擇 <code>Open AI resource</code>，然後選擇 <code>Keys and Endpoint</code> 並複製 <code>Key 1</code> 的值來找到你的 Azure OpenAI 金鑰。</p>
</blockquote>
<ol>
<li>建立一個 <em>app.py</em> 文件並給它以下程式碼:</li>
</ol>
<p>```python
   import openai</p>
<p>openai.api_key = "<replace this value with your open ai key or Azure OpenAI key>"</p>
<p>openai.api_type = 'azure'
   openai.api_version = '2023-05-15'
   openai.api_base = "<endpoint found in Azure Portal where your API key is>"
   deployment_name = "<deployment name>"</p>
<p># 添加你的完成程式碼
   prompt = "Complete the following: Once upon a time there was a"
   messages = [{"role": "user", "content": prompt}]</p>
<p># 進行完成
   completion = client.chat.completions.create(model=deployment, messages=messages)</p>
<p># 打印回應
   print(completion.choices[0].message.content)
   ```</p>
<blockquote>
<p>[!NOTE]
如果你使用的是 Azure OpenAI，你需要將 <code>api_type</code> 設置為 <code>azure</code> 並將 <code>api_key</code> 設置為你的 Azure OpenAI 金鑰。</p>
</blockquote>
<p>你應該會看到如下輸出:</p>
<p>```output
    very unhappy _____.</p>
<p>Once upon a time there was a very unhappy mermaid.
   ```</p>
<h2 id="_11">不同類型的提示，用於不同的事情</h2>
<p>現在你已經看到了如何使用提示生成文本。你甚至有一個正在執行的程式碼，可以修改和更改以生成不同類型的文本。</p>
<p>提示可以用於各種任務。例如:</p>
<ul>
<li><strong>生成一種類型的文本</strong>。例如，你可以生成一首詩、測驗的問題等。</li>
<li><strong>查找資訊</strong>。你可以使用提示來查找資訊，例如以下範例'在網頁開發中，CORS 是什麼意思？'。</li>
<li><strong>生成程式碼</strong>。你可以使用提示來生成程式碼，例如開發用於驗證電子郵件的正則表達式，或者為什麼不生成整個程式，例如一個網頁應用程式？</li>
</ul>
<h2 id="_12">更實用的使用案例: 秘訣產生器</h2>
<p>想像一下你在家裡有食材，並且你想做些料理。為此，你需要一個秘訣。一種找到秘訣的方法是使用搜尋引擎，或者你可以使用 LLM 來完成。</p>
<p>你可以這樣寫一個提示：</p>
<blockquote>
<p>"給我 5 個使用以下食材的菜餚秘訣: 雞肉、馬鈴薯和胡蘿蔔。每個秘訣列出所有使用的食材"</p>
</blockquote>
<p>根據上述提示，你可能會得到類似的回應:</p>
<pre><code class="language-output">1. 烤雞和蔬菜:
材料:
- 4 塊雞腿
- 2 個馬鈴薯，切成塊
- 2 根胡蘿蔔，切成塊
- 2 湯匙橄欖油
- 2 瓣大蒜，切碎
- 1 茶匙乾百里香
- 1 茶匙乾牛至
- 鹽和胡椒，適量

2. 雞肉和馬鈴薯燉菜:
材料:
- 2 湯匙橄欖油
- 1 個洋蔥，切丁
- 2 瓣大蒜，切碎
- 2 塊雞胸肉，切成塊
- 2 個馬鈴薯，切成塊
- 2 根胡蘿蔔，切成塊
- 1 茶匙乾牛至
- 1 茶匙乾百里香
- 1 杯雞湯
- 鹽和胡椒，適量

3. 雞肉和馬鈴薯烤盤:
材料:
- 2 湯匙橄欖油
- 2 塊雞胸肉，切成塊
- 2 個馬鈴薯，切成塊
- 2 根胡蘿蔔，切成塊
- 1 個洋蔥，切丁
- 2 瓣大蒜，切碎
- 1 茶匙乾牛至
- 1 茶匙乾百里香
- 1 杯雞湯
- 鹽和胡椒，適量

4. 雞肉和馬鈴薯湯:
材料:
- 2 湯匙橄欖油
- 1 個洋蔥，切丁
- 2 瓣大蒜，切碎
- 2 塊雞胸肉，切成塊
- 2 個馬鈴薯，切成塊
- 2 根胡蘿蔔，切成塊
- 1 茶匙乾牛至
- 1 茶匙乾百里香
- 4 杯雞湯
- 鹽和胡椒，適量

5. 雞肉和馬鈴薯雜燴:
材料:
- 2 湯匙橄欖油
- 2 塊雞胸肉，切成塊
- 2 個馬鈴薯，切成塊
- 2 根胡蘿蔔，切成塊
- 1 個洋蔥，切丁
- 2 瓣大蒜，切碎
- 1 茶匙乾牛至
</code></pre>
<p>這個結果很棒，我知道要煮什麼。此時，可能有用的改進是:</p>
<ul>
<li>過濾掉我不喜歡或過敏的食材。</li>
<li>產生購物清單，以防我家裡沒有所有食材。</li>
</ul>
<p>對於上述情況，讓我們添加一個額外的提示:</p>
<blockquote>
<p>"請移除含有大蒜的秘訣，因為我對大蒜過敏，並用其他東西替代。另外，請為這些秘訣製作一個購物清單，考慮到我家裡已經有雞肉、馬鈴薯和胡蘿蔔。"</p>
</blockquote>
<p>現在你有一個新結果，即：</p>
<pre><code class="language-output">1. 烤雞和蔬菜:
食材:
- 4 隻雞腿
- 2 個馬鈴薯，切成塊
- 2 根胡蘿蔔，切成塊
- 2 湯匙橄欖油
- 1 茶匙乾百里香
- 1 茶匙乾牛至
- 鹽和胡椒，適量

2. 雞肉和馬鈴薯燉菜:
食材:
- 2 湯匙橄欖油
- 1 個洋蔥，切丁
- 2 塊雞胸肉，切成塊
- 2 個馬鈴薯，切成塊
- 2 根胡蘿蔔，切成塊
- 1 茶匙乾牛至
- 1 茶匙乾百里香
- 1 杯雞湯
- 鹽和胡椒，適量

3. 雞肉和馬鈴薯烤盤:
食材:
- 2 湯匙橄欖油
- 2 塊雞胸肉，切成塊
- 2 個馬鈴薯，切成塊
- 2 根胡蘿蔔，切成塊
- 1 個洋蔥，切丁
- 1 茶匙乾牛至
- 1 茶匙乾百里香
- 1 杯雞湯
- 鹽和胡椒，適量

4. 雞肉和馬鈴薯湯:
食材:
- 2 湯匙橄欖油
- 1 個洋蔥，切丁
- 2 塊雞胸肉，切成塊
- 2 個馬鈴薯，切成塊
- 2 根胡蘿蔔，切成塊
- 1 茶匙乾牛至
- 1 茶匙乾百里香
- 4 杯雞湯
- 鹽和胡椒，適量

5. 雞肉和馬鈴薯雜燴:
食材:
- 2 湯匙橄欖油
- 2 塊雞胸肉，切成塊
- 2 個馬鈴薯，切成塊
- 2 根胡蘿蔔，切成塊
- 1 個洋蔥，切丁
- 1 茶匙乾牛至

購物清單:
- 橄欖油
- 洋蔥
- 百里香
- 牛至
- 鹽
- 胡椒
</code></pre>
<p>這就是你的五個秘訣，沒有提到大蒜，並且你還有一個購物清單，考慮到你家裡已經有的東西。</p>
<h2 id="-_1">練習 - 建構一個秘訣產生器</h2>
<p>現在我們已經演示了一個場景，讓我們寫程式碼來匹配演示的場景。要做到這一點，請按照以下步驟操作:</p>
<ol>
<li>使用現有的 <em>app.py</em> 文件作為起點</li>
<li>找到 <code>prompt</code> 變數並將其程式碼更改為以下內容：</li>
</ol>
<p><code>python
   prompt = "Show me 5 recipes for a dish with the following ingredients: chicken, potatoes, and carrots. Per recipe, list all the ingredients used"</code></p>
<p>如果你現在執行程式碼，你應該會看到類似以下的輸出：</p>
<p>```output
   -Chicken Stew with Potatoes and Carrots: 3 tablespoons oil, 1 onion, chopped, 2 cloves garlic, minced, 1 carrot, peeled and chopped, 1 potato, peeled and chopped, 1 bay leaf, 1 thyme sprig, 1/2 teaspoon salt, 1/4 teaspoon black pepper, 1 1/2 cups chicken broth, 1/2 cup dry white wine, 2 tablespoons chopped fresh parsley, 2 tablespoons unsalted butter, 1 1/2 pounds boneless, skinless chicken thighs, cut into 1-inch pieces
   -Oven-Roasted Chicken with Potatoes and Carrots: 3 tablespoons extra-virgin olive oil, 1 tablespoon Dijon mustard, 1 tablespoon chopped fresh rosemary, 1 tablespoon chopped fresh thyme, 4 cloves garlic, minced, 1 1/2 pounds small red potatoes, quartered, 1 1/2 pounds carrots, quartered lengthwise, 1/2 teaspoon salt, 1/4 teaspoon black pepper, 1 (4-pound) whole chicken
   -Chicken, Potato, and Carrot Casserole: cooking spray, 1 large onion, chopped, 2 cloves garlic, minced, 1 carrot, peeled and shredded, 1 potato, peeled and shredded, 1/2 teaspoon dried thyme leaves, 1/4 teaspoon salt, 1/4 teaspoon black pepper, 2 cups fat-free, low-sodium chicken broth, 1 cup frozen peas, 1/4 cup all-purpose flour, 1 cup 2% reduced-fat milk, 1/4 cup grated Parmesan cheese</p>
<p>-One Pot Chicken and Potato Dinner: 2 tablespoons olive oil, 1 pound boneless, skinless chicken thighs, cut into 1-inch pieces, 1 large onion, chopped, 3 cloves garlic, minced, 1 carrot, peeled and chopped, 1 potato, peeled and chopped, 1 bay leaf, 1 thyme sprig, 1/2 teaspoon salt, 1/4 teaspoon black pepper, 2 cups chicken broth, 1/2 cup dry white wine</p>
<p>-Chicken, Potato, and Carrot Curry: 1 tablespoon vegetable oil, 1 large onion, chopped, 2 cloves garlic, minced, 1 carrot, peeled and chopped, 1 potato, peeled and chopped, 1 teaspoon ground coriander, 1 teaspoon ground cumin, 1/2 teaspoon ground turmeric, 1/2 teaspoon ground ginger, 1/4 teaspoon cayenne pepper, 2 cups chicken broth, 1/2 cup dry white wine, 1 (15-ounce) can chickpeas, drained and rinsed, 1/2 cup raisins, 1/2 cup chopped fresh cilantro
   ```</p>
<blockquote>
<p>注意，你的 LLM 是非確定性的，所以每次執行程式時可能會得到不同的結果。</p>
</blockquote>
<p>很好，讓我們看看如何改進。為了改進，我們希望確保程式碼是靈活的，以便可以改進和更改食材和食譜數量。</p>
<ol>
<li>讓我們以以下方式更改程式碼：</li>
</ol>
<p>```python
   no_recipes = input("No of recipes (for example, 5: ")</p>
<p>ingredients = input("List of ingredients (for example, chicken, potatoes, and carrots: ")</p>
<p># interpolate the number of recipes into the prompt an ingredients
   prompt = f"Show me {no_recipes} recipes for a dish with the following ingredients: {ingredients}. Per recipe, list all the ingredients used"
   ```</p>
<p>測試執行程式碼，可能看起來像這樣：</p>
<p>```output
   No of recipes (for example, 5: 3
   List of ingredients (for example, chicken, potatoes, and carrots: milk,strawberries</p>
<p>-Strawberry milk shake: milk, strawberries, sugar, vanilla extract, ice cubes
   -Strawberry shortcake: milk, flour, baking powder, sugar, salt, unsalted butter, strawberries, whipped cream
   -Strawberry milk: milk, strawberries, sugar, vanilla extract
   ```</p>
<h3 id="_13">改進：新增篩選和購物清單</h3>
<p>我們現在有一個可運作的應用程式，能夠產生秘訣，並且它很靈活，因為它依賴於使用者的輸入，不僅是秘訣的數量，還有使用的成分。</p>
<p>為了進一步改進它，我們想添加以下內容:</p>
<ul>
<li><strong>篩選食材</strong>。我們希望能夠篩選出我們不喜歡或過敏的食材。為了完成這個變更，我們可以編輯現有的提示，並在其末尾添加一個篩選條件，如下所示：</li>
</ul>
<p>```python
  filter = input("篩選（例如，素食，純素，或無麩質: ")</p>
<p>prompt = f"給我{no_recipes}道菜的食譜，包含以下食材: {ingredients}。每個食譜列出所有使用的食材，不包含{filter}"
  ```</p>
<p>上述程式碼中，我們在提示的末尾添加了<code>{filter}</code>，並且從用戶那裡獲取篩選值。</p>
<p>現在，執行程式的範例輸入可以如下所示：</p>
<p>```output
  食譜數量（例如，5: 3
  食材列表（例如，雞肉，馬鈴薯和胡蘿蔔: 洋蔥,牛奶
  篩選（例如，素食，純素，或無麩質: 不含牛奶</p>
<ol>
<li>法式洋蔥湯</li>
</ol>
<p>食材:</p>
<p>-1個大洋蔥，切片
  -3杯牛肉湯
  -1杯牛奶
  -6片法國麵包
  -1/4杯磨碎的帕瑪森起司
  -1湯匙黃油
  -1茶匙乾百里香
  -1/4茶匙鹽
  -1/4茶匙黑胡椒</p>
<p>做法:</p>
<ol>
<li>在大鍋中，用黃油將洋蔥炒至金黃色。</li>
<li>加入牛肉湯、牛奶、百里香、鹽和胡椒。煮沸。</li>
<li>降低火候，煮10分鐘。</li>
<li>將法國麵包片放在湯碗中。</li>
<li>將湯舀在麵包上。</li>
<li>
<p>撒上帕瑪森起司。</p>
</li>
<li>
<p>洋蔥和馬鈴薯湯</p>
</li>
</ol>
<p>食材:</p>
<p>-1個大洋蔥，切碎
  -2杯馬鈴薯，切丁
  -3杯蔬菜湯
  -1杯牛奶
  -1/4茶匙黑胡椒</p>
<p>做法:</p>
<ol>
<li>在大鍋中，用黃油將洋蔥炒至金黃色。</li>
<li>加入馬鈴薯、蔬菜湯、牛奶和胡椒。煮沸。</li>
<li>降低火候，煮10分鐘。</li>
<li>
<p>熱食。</p>
</li>
<li>
<p>奶油洋蔥湯</p>
</li>
</ol>
<p>食材:</p>
<p>-1個大洋蔥，切碎
  -3杯蔬菜湯
  -1杯牛奶
  -1/4茶匙黑胡椒
  -1/4杯通用麵粉
  -1/2杯磨碎的帕瑪森起司</p>
<p>做法:</p>
<ol>
<li>在大鍋中，用黃油將洋蔥炒至金黃色。</li>
<li>加入蔬菜湯、牛奶和胡椒。煮沸。</li>
<li>降低火候，煮10分鐘。</li>
<li>在小碗中，將麵粉和帕瑪森起司攪拌均勻，直到光滑。</li>
<li>加入湯中，繼續煮5分鐘，或直到湯變稠。
  ```</li>
</ol>
<p>如你所見，任何含有牛奶的食譜都被篩選掉了。但是，如果你對乳糖不耐，你可能還想篩選掉含有起司的食譜，因此需要明確說明。</p>
<ul>
<li><strong>生成購物清單</strong>。我們希望生成購物清單，考慮到我們家裡已經有的食材。</li>
</ul>
<p>對於這個功能，我們可以嘗試在一個提示中解決所有問題，或者我們可以將其分成兩個提示。讓我們嘗試後者的方法。這裡我們建議添加一個額外的提示，但為了使其工作，我們需要將前一個提示的結果作為上下文添加到後一個提示中。</p>
<p>找到程式碼中打印出第一個提示結果的部分，並在其下方添加以下程式碼：</p>
<p>```python
  old_prompt_result = completion.choices[0].message.content
  prompt = "為生成的食譜生成購物清單，請不要包括我已經有的食材。"</p>
<p>new_prompt = f"{old_prompt_result} {prompt}"
  messages = [{"role": "user", "content": new_prompt}]
  completion = openai.Completion.create(engine=deployment_name, messages=messages, max_tokens=1200)</p>
<p># 打印回應
  print("購物清單:")
  print(completion.choices[0].message.content)
  ```</p>
<p>注意以下幾點：</p>
<ol>
<li>
<p>我們通過將第一個提示的結果添加到新提示中來構建一個新提示：</p>
<p><code>python
 new_prompt = f"{old_prompt_result} {prompt}"</code></p>
</li>
<li>
<p>我們發出一個新請求，但也考慮到我們在第一個提示中請求的 token 數量，所以這次我們說 <code>max_tokens</code> 是1200。</p>
<p><code>python
 completion = openai.Completion.create(engine=deployment_name, prompt=new_prompt, max_tokens=1200)</code></p>
<p>試用這段程式碼，我們現在得到以下輸出：</p>
<p>```output
 食譜數量（例如，5: 2
 食材列表（例如，雞肉，馬鈴薯和胡蘿蔔: 蘋果,麵粉
 篩選（例如，素食，純素，或無麩質: 糖</p>
<p>-蘋果和麵粉煎餅: 1杯麵粉，1/2茶匙泡打粉，1/2茶匙小蘇打，1/4茶匙鹽，1湯匙糖，1個雞蛋，1杯酪乳或酸奶，1/4杯融化的黃油，1個格蘭尼史密斯蘋果，去皮並磨碎
 -蘋果油炸圈餅: 1-1/2杯麵粉，1茶匙泡打粉，1/4茶匙鹽，1/4茶匙小蘇打，1/4茶匙肉豆蔻，1/4茶匙肉桂，1/4茶匙五香粉，1/4杯糖，1/4杯植物油，1/4杯牛奶，1個雞蛋，2杯磨碎的去皮蘋果
 購物清單:
 -麵粉，泡打粉，小蘇打，鹽，糖，雞蛋，酪乳，黃油，蘋果，肉豆蔻，肉桂，五香粉
 ```</p>
</li>
</ol>
<h2 id="_14">改善你的設定</h2>
<p>我們目前擁有的是可以運作的程式碼, 但我們應該做一些調整來進一步改進。一些我們應該做的事情是:</p>
<ul>
<li>
<p><strong>將秘密從程式碼中分離</strong>，例如 API 金鑰。秘密不應該存在於程式碼中，應該儲存在安全的位置。要將秘密從程式碼中分離，我們可以使用環境變數和像 <code>python-dotenv</code> 這樣的函式庫從文件中載入它們。以下是程式碼中的做法：</p>
</li>
<li>
<p>建立一個 <code>.env</code> 文件，內容如下：</p>
<p><code>bash
 OPENAI_API_KEY=sk-...</code></p>
<blockquote>
<p>注意，對於 Azure，你需要設定以下環境變數：</p>
</blockquote>
<p><code>bash
 OPENAI_API_TYPE=azure
 OPENAI_API_VERSION=2023-05-15
 OPENAI_API_BASE=&lt;replace&gt;</code></p>
<p>在程式碼中，你可以這樣載入環境變數：</p>
<p>```python
 from dotenv import load_dotenv</p>
<p>load_dotenv()</p>
<p>openai.api_key = os.environ["OPENAI_API_KEY"]
 ```</p>
</li>
<li>
<p><strong>關於 token 長度的一句話</strong>。我們應該考慮需要多少 token 來生成我們想要的文本。token 是要花錢的，所以在可能的情況下，我們應該嘗試節省使用的 token 數量。例如，我們能否調整提示語句以使用更少的 token？</p>
</li>
</ul>
<p>要更改使用的 token 數量，你可以使用 <code>max_tokens</code> 參數。例如，如果你想使用 100 個 token，你可以這樣做：</p>
<p><code>python
  completion = client.chat.completions.create(model=deployment, messages=messages, max_tokens=100)</code></p>
<ul>
<li><strong>嘗試調整 temperature</strong>。temperature 是我們到目前為止還沒有提到的，但它對我們程式的表現有重要影響。temperature 值越高，輸出就越隨機。相反，temperature 值越低，輸出就越可預測。考慮你是否希望輸出有變化。</li>
</ul>
<p>要改變 temperature，你可以使用 <code>temperature</code> 參數。例如，如果你想使用 0.5 的 temperature，你可以這樣做：</p>
<p><code>python
  completion = client.chat.completions.create(model=deployment, messages=messages, temperature=0.5)</code></p>
<blockquote>
<p>注意，越接近 1.0，輸出越多樣化。</p>
</blockquote>
<h2 id="_15">作業</h2>
<p>在這個作業中，你可以選擇要建構什麼。</p>
<p>以下是一些建議：</p>
<ul>
<li>調整秘訣產生器應用程式以進一步改進。嘗試不同的溫度值和提示，看看你能想出什麼。</li>
<li>建立一個「學習夥伴」。這個應用程式應該能夠回答關於某個主題的問題，例如 Python，你可以有類似「Python 中的某個主題是什麼？」的提示，或者你可以有一個提示說，顯示某個主題的程式碼等。</li>
<li>歷史機器人，讓歷史重現，指示機器人扮演某個歷史人物，並詢問它關於其生活和時代的問題。</li>
</ul>
<h2 id="_16">解決方案</h2>
<h3 id="_17">學習夥伴</h3>
<p>以下是一個入門提示，看看你如何使用它並根據自己的喜好進行調整。</p>
<pre><code class="language-text">- &quot;你是 Python 語言的專家

    建議一個適合初學者的 Python 課程，格式如下:

    格式:
    - 概念:
    - 課程簡要說明:
    - 帶解答的程式碼練習&quot;
</code></pre>
<h3 id="_18">歷史機器人</h3>
<p>以下是一些你可以使用的提示:</p>
<pre><code class="language-text">- &quot;你是 Abe Lincoln，用三句話告訴我你自己，並使用 Abe 會使用的語法和詞彙來回答&quot;
- &quot;你是 Abe Lincoln，使用 Abe 會使用的語法和詞彙來回答：

   用 300 字告訴我你最大的成就&quot;
</code></pre>
<h2 id="_19">知識檢查</h2>
<p>概念溫度是做什麼的？</p>
<ol>
<li>它控制輸出的隨機程度。</li>
<li>它控制回應的大小。</li>
<li>它控制使用的標記數量。</li>
</ol>
<h2 id="_20">🚀 挑戰</h2>
<p>在完成作業時，嘗試變更溫度，嘗試將其設為 0、0.5 和 1。記住，0 是變化最小的，1 是變化最大的，哪個值最適合你的應用程式？</p>
<h2 id="_21">很棒的工作！繼續學習</h2>
<p>完成本課程後，請查看我們的<a href="https://aka.ms/genai-collection?WT.mc_id=academic-105485-koreyst">生成式 AI 學習集合</a>以繼續提升您的生成式 AI 知識！</p>
<p>前往第7課，我們將探討如何<a href="../../../07-building-chat-applications/translations/tw/?WT.mc_id=academic-105485-koreyst">建構聊天應用程式</a>！</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../../..";</script>
    <script src="../../../js/theme_extra.js"></script>
    <script src="../../../js/theme.js"></script>
      <script src="../../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
