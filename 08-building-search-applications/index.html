<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Building a Search Applications - GenAI新手入门</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Building a Search Applications";
        var mkdocs_page_input_path = "08-building-search-applications\\README.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> GenAI新手入门
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../00-course-setup/translations/cn/">课程介绍和学习环境设置</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../01-introduction-to-genai/translations/cn/">第一章：生成式人工智能和 LLMs 介绍</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../02-exploring-and-comparing-different-llms/translations/cn/">第二章：探索和比较不同的 LLMs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../03-using-generative-ai-responsibly/translations/cn/">第三章：负责任地使用生成式人工智能</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../04-prompt-engineering-fundamentals/translations/cn/">第四章：提示工程基础</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../05-advanced-prompts/translations/cn/">第五章：创建高级的提示工程技巧</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../06-text-generation-apps/translations/cn/">第六章：创建文本生成应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../07-building-chat-applications/translations/cn/">第七章：创建聊天应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="translations/cn/">第八章：创建搜索应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../09-building-image-applications/translations/cn/">第九章：创建图像应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../10-building-low-code-ai-applications/translations/cn/">第十章：创建低代码AI应用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../11-integrating-with-function-calling/translations/cn/">第十一章：集成函数调用</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../12-designing-ux-for-ai-applications/translations/cn/">第十二章：为人工智能应用程序设计用户体验</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../13-securing-ai-applications/translations/cn/">第十三章：保护AI应用程序</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../14-the-generative-ai-application-lifecycle/translations/cn/">第十四章：生成式AI应用生命周期</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../15-rag-and-vector-databases/translations/cn/">第十五章：检索增强生成和向量数据库</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../16-open-source-models/translations/tw/">第十六章：开源模型</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../17-ai-agents/translations/tw/">第十七章：AI Agent</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../18-fine-tuning/translations/tw/">第十八章：微调</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../19-slm/">第十九章：SLM模型</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../20-mistral/">第二十章：Mistral的模型</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../21-meta/">第二十一章：Meta的模型</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">GenAI新手入门</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Building a Search Applications</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="building-a-search-applications">Building a Search Applications</h1>
<p><a href="https://aka.ms/gen-ai-lesson8-gh?WT.mc_id=academic-105485-koreyst"><img alt="Introduction to Generative AI and Large Language Models" src="images/08-lesson-banner.png?WT.mc_id=academic-105485-koreyst" /></a></p>
<blockquote>
<blockquote>
<p><em>Click the image above to view video of this lesson</em></p>
</blockquote>
</blockquote>
<p>There's more to LLMs than chatbots and text generation. It's also possible to build search applications using Embeddings. Embeddings are numerical representations of data also known as vectors, and can be used for semantic search for data.</p>
<p>In this lesson, you are going to build a search application for our education startup. Our startup is a non-profit organization that provides free education to students in developing countries. Our startup has a large number of YouTube videos that students can use to learn about AI. Our startup wants to build a search application that allows students to search for a YouTube video by typing a question.</p>
<p>For example, a student might type in 'What are Jupyter Notebooks?' or 'What is Azure ML' and the search application will return a list of YouTube videos that are relevant to the question, and better still, the search application will return a link to the place in the video where the answer to the question is located.</p>
<h2 id="introduction">Introduction</h2>
<p>In this lesson, we will cover:</p>
<ul>
<li>Semantic vs Keyword search.</li>
<li>What are Text Embeddings.</li>
<li>Creating a Text Embeddings Index.</li>
<li>Searching a Text Embeddings Index.</li>
</ul>
<h2 id="learning-goals">Learning Goals</h2>
<p>After completing this lesson, you will be able to:</p>
<ul>
<li>Tell the difference between semantic and keyword search.</li>
<li>Explain what Text Embeddings are.</li>
<li>Create an application using Embeddings to search for data.</li>
</ul>
<h2 id="why-build-a-search-application">Why build a search application?</h2>
<p>Creating a search application will help you understand how to use Embeddings to search for data. You will also learn how to build a search application that can be used by students to find information quickly.</p>
<p>The lesson includes an Embedding Index of the YouTube transcripts for the Microsoft <a href="https://www.youtube.com/playlist?list=PLlrxD0HtieHi0mwteKBOfEeOYf0LJU4O1">AI Show</a> YouTube channel. The AI Show is a YouTube channel that teaches you about AI and machine learning. The Embedding Index contains the Embeddings for each of the YouTube transcripts up until Oct 2023. You will use the Embedding Index to build a search application for our startup. The search application returns a link to the place in the video where the answer to the question is located. This is a great way for students to find the information they need quickly.</p>
<p>The following is an example of a semantic query for the question 'can you use rstudio with azure ml?'. Check out the YouTube url, you'll see the url contains a timestamp that takes you to the place in the video where the answer to the question is located.</p>
<p><img alt="Semantic query for the question &quot;can you use rstudio with Azure ML&quot;" src="images/query-results.png?WT.mc_id=academic-105485-koreyst" /></p>
<h2 id="what-is-semantic-search">What is semantic search?</h2>
<p>Now you might be wondering, what is semantic search? Semantic search is a search technique that uses the semantics, or meaning, of the words in a query to return relevant results.</p>
<p>Here is an example of a semantic search. Let's say you were looking to buy a car, you might search for 'my dream car', semantic search understands that you are not <code>dreaming</code> about a car, but rather you are looking to buy your <code>ideal</code> car. Semantic search understands your intention and returns relevant results. The alternative is <code>keyword search</code> which would literally search for dreams about cars and often returns irrelevant results.</p>
<h2 id="what-are-text-embeddings">What are Text Embeddings?</h2>
<p><a href="https://en.wikipedia.org/wiki/Word_embedding?WT.mc_id=academic-105485-koreyst">Text embeddings</a> are a text representation technique used in <a href="https://en.wikipedia.org/wiki/Natural_language_processing?WT.mc_id=academic-105485-koreyst">natural language processing</a>. Text embeddings are semantic numerical representations of text. Embeddings are used to represent data in a way that is easy for a machine to understand. There are many models for building text embeddings, in this lesson, we will focus on generating embeddings using the OpenAI Embedding Model.</p>
<p>Here's an example, imagine the following text is in a transcript from one of the episodes on the AI Show YouTube channel:</p>
<pre><code class="language-text">Today we are going to learn about Azure Machine Learning.
</code></pre>
<p>We'd pass the text to the OpenAI Embedding API and it would return the following embedding consisting of 1536 numbers aka a vector. Each number in the vector represents a different aspect of the text. For brevity, here are the first 10 numbers in the vector.</p>
<pre><code class="language-python">[-0.006655829958617687, 0.0026128944009542465, 0.008792596869170666, -0.02446001023054123, -0.008540431968867779, 0.022071078419685364, -0.010703742504119873, 0.003311325330287218, -0.011632772162556648, -0.02187200076878071, ...]
</code></pre>
<h2 id="how-is-the-embedding-index-created">How is the Embedding index created?</h2>
<p>The Embedding index for this lesson was created with a series of Python scripts. You'll find the scripts along with instructions in the <a href="scripts/?WT.mc_id=academic-105485-koreyst">README</a> in the 'scripts` folder for this lesson. You don't need to run these scripts to complete this lesson as the Embedding Index is provided for you.</p>
<p>The scripts perform the following operations:</p>
<ol>
<li>The transcript for each YouTube video in the <a href="https://www.youtube.com/playlist?list=PLlrxD0HtieHi0mwteKBOfEeOYf0LJU4O1">AI Show</a> playlist is downloaded.</li>
<li>Using <a href="https://learn.microsoft.com/azure/ai-services/openai/how-to/function-calling?WT.mc_id=academic-105485-koreyst">OpenAI Functions</a>, an attempt is made to extract the speaker name from the first 3 minutes of the YouTube transcript. The speaker name for each video is stored in the Embedding Index named <code>embedding_index_3m.json</code>.</li>
<li>The transcript text is then chunked into <strong>3 minute text segments</strong>. The segment includes about 20 words overlapping from the next segment to ensure that the Embedding for the segment is not cut off and to provide better search context.</li>
<li>Each text segment is then passed to the OpenAI Chat API to summarize the text into 60 words. The summary is also stored in the Embedding Index <code>embedding_index_3m.json</code>.</li>
<li>Finally, the segment text is passed to the OpenAI Embedding API. The Embedding API returns a vector of 1536 numbers that represent the semantic meaning of the segment. The segment along with the OpenAI Embedding vector is stored in an Embedding Index <code>embedding_index_3m.json</code>.</li>
</ol>
<h3 id="vector-databases">Vector Databases</h3>
<p>For lesson simplicity, the Embedding Index is stored in a JSON file named <code>embedding_index_3m.json</code> and loaded into a Pandas DataFrame. However, in production, the Embedding Index would be stored in a vector database such as <a href="https://learn.microsoft.com/training/modules/improve-search-results-vector-search?WT.mc_id=academic-105485-koreyst">Azure Cognitive Search</a>, <a href="https://cookbook.openai.com/examples/vector_databases/redis/readme?WT.mc_id=academic-105485-koreyst">Redis</a>, <a href="https://cookbook.openai.com/examples/vector_databases/pinecone/readme?WT.mc_id=academic-105485-koreyst">Pinecone</a>, <a href="https://cookbook.openai.com/examples/vector_databases/weaviate/readme?WT.mc_id=academic-105485-koreyst">Weaviate</a>, to name but a few.</p>
<h2 id="understanding-cosine-similarity">Understanding cosine similarity</h2>
<p>We've learned about text embeddings, the next step is to learn how to use text embeddings to search for data and in particular find the most similar embeddings to a given query using cosine similarity.</p>
<h3 id="what-is-cosine-similarity">What is cosine similarity?</h3>
<p>Cosine similarity is a measure of similarity between two vectors, you'll also hear this referred to as <code>nearest neighbor search</code>. To perform a cosine similarity search you need to <em>vectorize</em> for <em>query</em> text using the OpenAI Embedding API. Then calculate the <em>cosine similarity</em> between the query vector and each vector in the Embedding Index. Remember, the Embedding Index has a vector for each YouTube transcript text segment. Finally, sort the results by cosine similarity and the text segments with the highest cosine similarity are the most similar to the query.</p>
<p>From a mathematic perspective, cosine similarity measures the cosine of the angle between two vectors projected in a multidimensional space. This measurement is beneficial, because if two documents are far apart by Euclidean distance because of size, they could still have a smaller angle between them and therefore higher cosine similarity. For more information about cosine similarity equations, see <a href="https://en.wikipedia.org/wiki/Cosine_similarity?WT.mc_id=academic-105485-koreyst">Cosine similarity</a>.</p>
<h2 id="building-your-first-search-application">Building your first search application</h2>
<p>Next, we're going to learn how to build a search application using Embeddings. The search application will allow students to search for a video by typing a question. The search application will return a list of videos that are relevant to the question. The search application will also return a link to the place in the video where the answer to the question is located.</p>
<p>This solution was built and tested on Windows 11, macOS, and Ubuntu 22.04 using Python 3.10 or later. You can download Python from <a href="https://www.python.org/downloads/?WT.mc_id=academic-105485-koreyst">python.org</a>.</p>
<h2 id="assignment-building-a-search-application-to-enable-students">Assignment - building a search application, to enable students</h2>
<p>We introduced our startup at the beginning of this lesson. Now it's time to enable the students to build a search application for their assessments.</p>
<p>In this assignment, you will create the Azure OpenAI Services that will be used to build the search application. You will create the following Azure OpenAI Services. You'll need an Azure subscription to complete this assignment.</p>
<h3 id="start-the-azure-cloud-shell">Start the Azure Cloud Shell</h3>
<ol>
<li>Sign in to the <a href="https://portal.azure.com/?WT.mc_id=academic-105485-koreyst">Azure portal</a>.</li>
<li>Select the Cloud Shell icon in the upper-right corner of the Azure portal.</li>
<li>Select <strong>Bash</strong> for the environment type.</li>
</ol>
<h4 id="create-a-resource-group">Create a resource group</h4>
<blockquote>
<p>For these instructions, we're using the resource group named "semantic-video-search" in East US.
You can change the name of the resource group, but when changing the location for the resources,
check the <a href="https://aka.ms/oai/models?WT.mc_id=academic-105485-koreyst">model availability table</a>.</p>
</blockquote>
<pre><code class="language-shell">az group create --name semantic-video-search --location eastus
</code></pre>
<h4 id="create-an-azure-openai-service-resource">Create an Azure OpenAI Service resource</h4>
<p>From the Azure Cloud Shell, run the following command to create an Azure OpenAI Service resource.</p>
<pre><code class="language-shell">az cognitiveservices account create --name semantic-video-openai --resource-group semantic-video-search \
    --location eastus --kind OpenAI --sku s0
</code></pre>
<h4 id="get-the-endpoint-and-keys-for-usage-in-this-application">Get the endpoint and keys for usage in this application</h4>
<p>From the Azure Cloud Shell, run the following commands to get the endpoint and keys for the Azure OpenAI Service resource.</p>
<pre><code class="language-shell">az cognitiveservices account show --name semantic-video-openai \
   --resource-group  semantic-video-search | jq -r .properties.endpoint
az cognitiveservices account keys list --name semantic-video-openai \
   --resource-group semantic-video-search | jq -r .key1
</code></pre>
<h4 id="deploy-the-openai-embedding-model">Deploy the OpenAI Embedding model</h4>
<p>From the Azure Cloud Shell, run the following command to deploy the OpenAI Embedding model.</p>
<pre><code class="language-shell">az cognitiveservices account deployment create \
    --name semantic-video-openai \
    --resource-group  semantic-video-search \
    --deployment-name text-embedding-ada-002 \
    --model-name text-embedding-ada-002 \
    --model-version &quot;2&quot;  \
    --model-format OpenAI \
    --sku-capacity 100 --sku-name &quot;Standard&quot;
</code></pre>
<h2 id="solution">Solution</h2>
<p>Open the <a href="python/aoai-solution.ipynb?WT.mc_id=academic-105485-koreyst">solution notebook</a> in GitHub Codespaces and follow the instructions in the Jupyter Notebook.</p>
<p>When you run the notebook, you'll be prompted to enter a query. The input box will look like this:</p>
<p><img alt="Input box for the user to input a query" src="images/notebook-search.png?WT.mc_id=academic-105485-koreyst" /></p>
<h2 id="great-work-continue-your-learning">Great Work! Continue Your Learning</h2>
<p>After completing this lesson, check out our <a href="https://aka.ms/genai-collection?WT.mc_id=academic-105485-koreyst">Generative AI Learning collection</a> to continue leveling up your Generative AI knowledge!</p>
<p>Head over to Lesson 9 where we will look at how to <a href="../09-building-image-applications/?WT.mc_id=academic-105485-koreyst">build image generation applications</a>!</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
